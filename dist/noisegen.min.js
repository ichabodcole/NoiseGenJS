/*! noisegen 2013-07-15 */
!function(){var a,b,c,d,e,f,g,h,i,j={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=function(){function a(b,c){this.noiseType=null!=c?c:a.BROWN_NOISE,this.input=b.createGain(),this.output=b.createGain(),this.instanceCount=0,this.bufferSize=4096,this.audioProcessor=null,this.noise=null,this.state=this.STOPPED,this.timeout=null,this.bufferTimeout=250,this._createInternalNodes(b),this._routeNodes()}return a.STOPPED=0,a.PLAYING=1,a.WHITE_NOISE="white",a.BROWN_NOISE="brown",a.PINK_NOISE="pink",a.SILENCE="silence",a.prototype._createInternalNodes=function(a){return this.audioProcessor=this._storeProcessor(a.createScriptProcessor(this.bufferSize,1,2))},a.prototype._routeNodes=function(){return this.input.connect(this.output)},a.prototype._getProcessorIndex=function(){var a;return window.NoiseGenProcessors=null!=(a=window.NoiseGenProcessors)?a:[]},a.prototype._storeProcessor=function(a){var b;return b=this._getProcessorIndex(),a.id=b.length,b[a.id]=a,a},a.prototype._removeProcessor=function(a){var b;return b=this._getProcessorIndex(),delete b[a.id],b.splice(a.id,1),a},a.prototype._createProcessorLoop=function(){var a=this;return this.audioProcessor.onaudioprocess=function(b){var c,d,e;for(d=b.outputBuffer.getChannelData(0),e=b.outputBuffer.getChannelData(1),c=0;c<a.bufferSize;)d[c]=a.noise.update(),e[c]=a.noise.update(),c++;return null},null},a.prototype._setNoiseGenerator=function(a){return this.noise=c.create(a)},a.prototype._createProcessorTimeout=function(){var a=this;return this.timeout=setTimeout(function(){return a.state===a.STOPPED?a.audioProcessor.disconnect():void 0},this.bufferTimeout)},a.prototype._clearProcessorTimeout=function(){return null!==this.timeout?clearTimeout(this.timeout):void 0},a.prototype.start=function(){return this.state===this.STOPPED?(this._clearProcessorTimeout(),this._setNoiseGenerator(this.noiseType),this._createProcessorLoop(),this.audioProcessor.connect(this.output),this.state=this.PLAYING):void 0},a.prototype.stop=function(){return this.state===this.PLAYING?(this._setNoiseGenerator(a.SILENCE),this._createProcessorTimeout(),this.state=this.STOPPED):void 0},a.prototype.remove=function(){return this._removeProcessor(this.audioProcessor)},a.prototype.connect=function(a){return this.output.connect(a.input?a.input:a)},a.prototype.disconnect=function(){return this.output.disconnect()},a.prototype.setNoiseType=function(a){return this.noiseType=a,this._setNoiseGenerator(this.noiseType)},a}(),c=function(){function b(){}return b.create=function(b){var c;return c=function(){switch(b){case d.WHITE_NOISE:return new g;case d.PINK_NOISE:return new e;case d.BROWN_NOISE:return new a;case d.SILENCE:return new f;default:return new a}}()},b}(),b=function(){function a(){}return a.prototype.update=function(){return"Not implemented"},a.prototype.random=function(){return 2*Math.random()-1},a}(),f=function(a){function b(){return h=b.__super__.constructor.apply(this,arguments)}return k(b,a),b.prototype.update=function(){return 0},b}(b),g=function(a){function b(){return i=b.__super__.constructor.apply(this,arguments)}return k(b,a),b.prototype.update=function(){return this.random()},b}(b),a=function(a){function b(){this.base=0}return k(b,a),b.prototype.update=function(){var a;return a=.1*this.random(),this.base+=a,(this.base<-1||this.base>1)&&(this.base-=a),this.base},b}(b),e=function(a){function b(){this.alpha=1,this.poles=5,this.multipliers=this.zeroFill([],this.poles),this.values=this.zeroFill([],this.poles),this.fillArrays()}return k(b,a),b.prototype.fillArrays=function(){var a,b,c,d,e,f,g,h,i;for(a=1,g=this.poles,c=0,e=g.length;e>c;c++)b=g[c],a=(b-this.alpha/2)*a/(b+1),this.multipliers[b]=a;for(h=5*this.poles,i=[],d=0,f=h.length;f>d;d++)b=h[d],i.push(this.update());return i},b.prototype.zeroFill=function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(a[c]=0);return f},b.prototype.update=function(){var a,b,c,d,e;for(b=1*this.random(),e=this.poles,c=0,d=e.length;d>c;c++)a=e[c],b-=this.multipliers[a]*this.values[a];return this.values.unshift(b),this.values.pop(),.5*b},b}(b),"function"==typeof define&&define.amd?define(function(){return d}):"object"==typeof window&&"object"==typeof window.document&&(window.NoiseGen=d)}.call(this);